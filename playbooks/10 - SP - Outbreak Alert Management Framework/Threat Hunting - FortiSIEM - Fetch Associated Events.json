{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Threat Hunting - FortiSIEM - Fetch Associated Events",
    "aliasName": null,
    "tag": null,
    "description": "Retrieves all associated events for a specified incident from the Fortinet FortiSIEM server based on the incident ID",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "incidentdata",
        "max_events"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/2ae30943-7a2f-435b-a100-3ec7c3e2294b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/58032bf0-1121-41c5-87f0-5156618cbaa2",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Fetch Events for Incident",
            "description": null,
            "arguments": {
                "name": "Fortinet FortiSIEM",
                "config": "cf97ef5d-fedf-4ffe-ad3b-27354b3c1fed",
                "params": {
                    "to": "",
                    "from": "",
                    "start": 0,
                    "allData": true,
                    "perPage": "{{vars.input.params['max_events'] | int}}",
                    "incident_id": "{{vars.input.params.incidentdata.sourceId}}"
                },
                "version": "5.0.1",
                "connector": "fortinet-fortisiem",
                "operation": "get_associated_events",
                "mock_result": "{\n  \"data\": [\n    {\n      \"id\": 541980067683135200,\n      \"nid\": \"541980067683135219\",\n      \"index\": 0,\n      \"custId\": 2000,\n      \"dataStr\": {},\n      \"eventType\": \"LINUX_PROCESS_EXEC\",\n      \"attributes\": {\n        \"User\": \"setroubleshoot\",\n        \"Count\": 1,\n        \"Command\": \"\/usr\/bin\/uname -p\",\n        \"Message\": \"audit(1691431536.529:642):\",\n        \"User Id\": \"986\",\n        \"Event ID\": 541980067683135200,\n        \"Hash Code\": \"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\",\n        \"Host Name\": \"rhel92\",\n        \"Event Type\": \"LINUX_PROCESS_EXEC\",\n        \"Message ID\": \"642\",\n        \"Relaying IP\": \"10.132.252.27\",\n        \"Collector ID\": 10000,\n        \"Command Path\": \"\/usr\/bin\/uname\",\n        \"Process Name\": \"uname\",\n        \"Reporting IP\": \"10.132.252.27\",\n        \"Raw Event Log\": \"<182>Aug  7 23:35:36 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691431536.529:642): arch=c000003e syscall=59 success=yes exit=0 a0=7f75b88c1fe0 a1=7f75b76e0fd0 a2=7ffebb360810 a3=3 items=2 ppid=33440 pid=33446 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n        \"Event Severity\": 1,\n        \"Hash Algorithm\": \"sha256\",\n        \"Software Param\": \"-p\",\n        \"Organization ID\": 2000,\n        \"Reporting Model\": \"Linux\",\n        \"Reporting Device\": \"rhel92.nsoni.local\",\n        \"Reporting Vendor\": \"Redhat\",\n        \"Effective User ID\": \"986\",\n        \"Event Parser Name\": \"LinuxAuditdParser\",\n        \"Organization Name\": \"test1\",\n        \"Time Zone Minutes\": 0,\n        \"Command exit value\": 0,\n        \"Event Parse Status\": 1,\n        \"Event Receive Time\": 1691431551000,\n        \"Event Rule Trigger\": 1,\n        \"Short Process Name\": \"uname\",\n        \"Parent Process Name\": \"setroubleshootd\",\n        \"System Event Category\": 0,\n        \"Event Severity Category\": \"LOW\",\n        \"External Event Receive Protocol\": \"Linux Agent\"\n      },\n      \"rawMessage\": \"<182>Aug  7 23:35:36 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691431536.529:642): arch=c000003e syscall=59 success=yes exit=0 a0=7f75b88c1fe0 a1=7f75b76e0fd0 a2=7ffebb360810 a3=3 items=2 ppid=33440 pid=33446 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n      \"receiveTime\": 1691431551000,\n      \"eventAttributes\": []\n    },\n    {\n      \"id\": 541980067683635300,\n      \"nid\": \"541980067683635300\",\n      \"index\": 1,\n      \"custId\": 2000,\n      \"dataStr\": {},\n      \"eventType\": \"LINUX_PROCESS_EXEC\",\n      \"attributes\": {\n        \"User\": \"setroubleshoot\",\n        \"Count\": 1,\n        \"Command\": \"\/usr\/bin\/uname -p\",\n        \"Message\": \"audit(1691427935.912:582):\",\n        \"User Id\": \"986\",\n        \"Event ID\": 541980067683635300,\n        \"Hash Code\": \"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\",\n        \"Host Name\": \"rhel92\",\n        \"Event Type\": \"LINUX_PROCESS_EXEC\",\n        \"Message ID\": \"582\",\n        \"Relaying IP\": \"10.132.252.27\",\n        \"Collector ID\": 10000,\n        \"Command Path\": \"\/usr\/bin\/uname\",\n        \"Process Name\": \"uname\",\n        \"Reporting IP\": \"10.132.252.27\",\n        \"Raw Event Log\": \"<182>Aug  7 22:35:35 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691427935.912:582): arch=c000003e syscall=59 success=yes exit=0 a0=7fe2dea46fe0 a1=7fe2dd85ebb0 a2=7ffe1d344200 a3=3 items=2 ppid=33384 pid=33390 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n        \"Event Severity\": 1,\n        \"Hash Algorithm\": \"sha256\",\n        \"Software Param\": \"-p\",\n        \"Organization ID\": 2000,\n        \"Reporting Model\": \"Linux\",\n        \"Reporting Device\": \"rhel92.nsoni.local\",\n        \"Reporting Vendor\": \"Redhat\",\n        \"Effective User ID\": \"986\",\n        \"Event Parser Name\": \"LinuxAuditdParser\",\n        \"Organization Name\": \"test1\",\n        \"Time Zone Minutes\": 0,\n        \"Command exit value\": 0,\n        \"Event Parse Status\": 1,\n        \"Event Receive Time\": 1691427950000,\n        \"Event Rule Trigger\": 1,\n        \"Short Process Name\": \"uname\",\n        \"Parent Process Name\": \"setroubleshootd\",\n        \"System Event Category\": 0,\n        \"Event Severity Category\": \"LOW\",\n        \"External Event Receive Protocol\": \"Linux Agent\"\n      },\n      \"rawMessage\": \"<182>Aug  7 22:35:35 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691427935.912:582): arch=c000003e syscall=59 success=yes exit=0 a0=7fe2dea46fe0 a1=7fe2dd85ebb0 a2=7ffe1d344200 a3=3 items=2 ppid=33384 pid=33390 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n      \"receiveTime\": 1691427950000,\n      \"eventAttributes\": []\n    },\n    {\n      \"id\": 541980067683535400,\n      \"nid\": \"541980067683535416\",\n      \"index\": 2,\n      \"custId\": 2000,\n      \"dataStr\": {},\n      \"eventType\": \"LINUX_PROCESS_EXEC\",\n      \"attributes\": {\n        \"User\": \"setroubleshoot\",\n        \"Count\": 1,\n        \"Command\": \"\/usr\/bin\/uname -p\",\n        \"Message\": \"audit(1691424335.465:529):\",\n        \"User Id\": \"986\",\n        \"Event ID\": 541980067683535400,\n        \"Hash Code\": \"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\",\n        \"Host Name\": \"rhel92\",\n        \"Event Type\": \"LINUX_PROCESS_EXEC\",\n        \"Message ID\": \"529\",\n        \"Relaying IP\": \"10.132.252.27\",\n        \"Collector ID\": 10000,\n        \"Command Path\": \"\/usr\/bin\/uname\",\n        \"Process Name\": \"uname\",\n        \"Reporting IP\": \"10.132.252.27\",\n        \"Raw Event Log\": \"<182>Aug  7 21:35:35 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691424335.465:529): arch=c000003e syscall=59 success=yes exit=0 a0=7fa8f6549fb0 a1=7fa8f5310470 a2=7ffd1bc41bb0 a3=3 items=2 ppid=33339 pid=33345 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n        \"Event Severity\": 1,\n        \"Hash Algorithm\": \"sha256\",\n        \"Software Param\": \"-p\",\n        \"Organization ID\": 2000,\n        \"Reporting Model\": \"Linux\",\n        \"Reporting Device\": \"rhel92.nsoni.local\",\n        \"Reporting Vendor\": \"Redhat\",\n        \"Effective User ID\": \"986\",\n        \"Event Parser Name\": \"LinuxAuditdParser\",\n        \"Organization Name\": \"test1\",\n        \"Time Zone Minutes\": 0,\n        \"Command exit value\": 0,\n        \"Event Parse Status\": 1,\n        \"Event Receive Time\": 1691424351000,\n        \"Event Rule Trigger\": 1,\n        \"Short Process Name\": \"uname\",\n        \"Parent Process Name\": \"setroubleshootd\",\n        \"System Event Category\": 0,\n        \"Event Severity Category\": \"LOW\",\n        \"External Event Receive Protocol\": \"Linux Agent\"\n      },\n      \"rawMessage\": \"<182>Aug  7 21:35:35 rhel92 audispd[33272]: type=SYSCALL msg=audit(1691424335.465:529): arch=c000003e syscall=59 success=yes exit=0 a0=7fa8f6549fb0 a1=7fa8f5310470 a2=7ffd1bc41bb0 a3=3 items=2 ppid=33339 pid=33345 auid=4294967295 uid=986 gid=986 euid=986 suid=986 fsuid=986 egid=986 sgid=986 fsgid=986 tty=(none) ses=4294967295 comm=\\\"uname\\\" exe=\\\"\/usr\/bin\/uname\\\" subj=system_u:system_r:setroubleshootd_t:s0 key=\\\"LINUX_PROCESS_EXEC\\\" ARCH=x86_64 SYSCALL=execve AUID=\\\"unset\\\" UID=\\\"setroubleshoot\\\" GID=\\\"setroubleshoot\\\" EUID=\\\"setroubleshoot\\\" SUID=\\\"setroubleshoot\\\" FSUID=\\\"setroubleshoot\\\" EGID=\\\"setroubleshoot\\\" SGID=\\\"setroubleshoot\\\" FSGID=\\\"setroubleshoot\\\" parentProc=\\\"setroubleshootd\\\" user=\\\"setroubleshoot\\\" hashAlgo=sha256 hashCode=\\\"ae44d73ad22c99374b0e7075cfd4b782f269b3d32b516338dae12f7f88cbabd9\\\" argc=2 a0=\\\"uname\\\" a1=\\\"-p\\\"\",\n      \"receiveTime\": 1691424351000,\n      \"eventAttributes\": []\n    }\n  ],\n  \"status\": \"Success\",\n  \"message\": \"\",\n  \"operation\": null,\n  \"execution_time\": \"752 ms\"\n}",
                "operationTitle": "Get Events For Incident",
                "step_variables": {
                    "fetch_event": "{{vars.steps.Fetch_Events_for_Incident.data}}"
                }
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "6a0a4a9e-683a-4e1a-8727-7407ff0a5362"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set Result",
            "description": null,
            "arguments": {
                "incident_details": "{\"incident_data\":  {{vars.input.params.incidentdata.sourcedata | toDict}}, \"associated_events\": {{vars.fetch_event}} }"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "e0354d22-5aa2-493d-b7c6-d264535ee573"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    },
                    "useMockOutput": "{{globalVars.Demo_mode}}"
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "58032bf0-1121-41c5-87f0-5156618cbaa2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Record",
            "description": null,
            "arguments": {
                "resource": {
                    "sourcedata": "{{vars.incident_details | toJSON }}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.incidentdata['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/alerts",
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "1773b8ff-5b32-4867-ac68-7b8ead50b1be"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Fetch Events for Incident -> Set Result",
            "targetStep": "\/api\/3\/workflow_steps\/e0354d22-5aa2-493d-b7c6-d264535ee573",
            "sourceStep": "\/api\/3\/workflow_steps\/6a0a4a9e-683a-4e1a-8727-7407ff0a5362",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "22d5dd90-69c6-4046-800f-ce56a66b36c3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set Result -> Update Record",
            "targetStep": "\/api\/3\/workflow_steps\/1773b8ff-5b32-4867-ac68-7b8ead50b1be",
            "sourceStep": "\/api\/3\/workflow_steps\/e0354d22-5aa2-493d-b7c6-d264535ee573",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "c045de0b-a909-4f27-a1a7-c89d9d7cc1f5"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Fetch Events for Incident",
            "targetStep": "\/api\/3\/workflow_steps\/6a0a4a9e-683a-4e1a-8727-7407ff0a5362",
            "sourceStep": "\/api\/3\/workflow_steps\/58032bf0-1121-41c5-87f0-5156618cbaa2",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8b81236a-6052-4677-b74d-0281f91e2f8b"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "97733935-0624-4e7c-aadc-ccc0dbe51fe1",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Subroutine",
        "Outbreak Alert",
        "FortiSIEM"
    ]
}