{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Threat Hunting - FortiAnalyzer - Get Events",
    "aliasName": null,
    "tag": null,
    "description": "Retrieve all events from FortiAnalyzer based on the outbreak alert filter query",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "fortiAnalyzer_query",
        "to_date",
        "from_date"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/2ae30943-7a2f-435b-a100-3ec7c3e2294b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/1cd36733-7b99-4418-9594-6821dedaf256",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "alerts_status_map": "{\"open\": {{\"AlertStatus\"| picklist(\"Open\")}}, \"mitigated\": {{\"AlertStatus\"| picklist(\"Investigating\")}}, \"contained\": {{\"AlertStatus\"| picklist(\"Closed\")}}, \"blank\": {{\"AlertStatus\"| picklist(\"Open\")}}  }",
                "alerts_severity_map": "{'high': {{'Severity'| picklist('High')}}, 'medium': {{'Severity'| picklist('Medium')}}, 'low': {{'Severity'| picklist('Low')}}, 'critical': {{'Severity'| picklist('Critical')}} }"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "c86fed14-ffa8-4670-b45a-6e5e84a6246c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Fetch Related Assets",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Get_Outbreak_Alert_Events.data.result.data}}",
                    "__bulk": false,
                    "parallel": true,
                    "condition": "{{vars.item | length > 0}}"
                },
                "arguments": {
                    "alert_data": "{{vars.item}}"
                },
                "apply_async": true,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/c4a0fd9f-d1ec-4efd-87ac-de21e53c9aae"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "b66fa412-f186-4306-94f0-1dd54d3a3592"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Outbreak Alert Events",
            "description": null,
            "arguments": {
                "name": "Fortinet FortiAnalyzer",
                "config": "1493e9a2-b4f9-44db-b9d3-26e4128eaa36",
                "params": {
                    "end": "{{vars.to_date}}",
                    "devid": "",
                    "limit": 50,
                    "start": "{{arrow.utcnow().shift(days=vars.from_date).format(\"YYYY-MM-DDTHH:mm:ss.SS\")}}Z",
                    "filter": "{{vars.fortiAnalyzer_query[0].filter}}",
                    "offset": 0,
                    "alertid": "",
                    "devname": "",
                    "adom_name": "{{vars.fortiAnalyzer_query[0].ADOM}}"
                },
                "message": {
                    "tags": [
                        "\/api\/3\/tags\/FortiAnalyzer"
                    ],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Retrieving all events from FortiAnalyzer based on the below details.<\/p>\n<p>- <strong><em>ADOM<\/em>:<\/strong> {{vars.fortiAnalyzer_query[0].ADOM}}<\/p>\n<p>- <strong><em>Query Filter<\/em>:<\/strong> &nbsp;{{vars.fortiAnalyzer_query[0].filter}}<\/p>",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "version": "3.2.0",
                "connector": "fortinet-fortianalyzer",
                "operation": "get_alerts",
                "mock_result": "{\n  \"data\": {\n    \"id\": 1,\n    \"result\": {\n      \"data\": [\n        {\n          \"tag\": \"Default,Risky,Recon,HTTPS\",\n          \"epid\": \"1147\",\n          \"epip\": \"10.2.0.17\",\n          \"euid\": \"1116\",\n          \"vdom\": \"root\",\n          \"devid\": \"FGVM02TM23008636\",\n          \"ackflag\": \"no\",\n          \"alertid\": \"202307201000000350\",\n          \"devname\": \"Branch_Office_02\",\n          \"devtype\": \"FortiGate\",\n          \"logtype\": \"traffic\",\n          \"subject\": \"IP scanning on Port: 443 detected\",\n          \"filterid\": \"4\",\n          \"groupby1\": \"endpoint:Kit Herman Laptop\",\n          \"groupby2\": \"dstport:443\",\n          \"logcount\": \"456\",\n          \"readflag\": \"no\",\n          \"severity\": \"medium\",\n          \"alerttime\": \"1689891354\",\n          \"eventtype\": \"traffic\",\n          \"extrainfo\": \"Recon activity from: 10.2.0.17:41036,.. to 23.33.92.144,..:443\",\n          \"filterkey\": \"-3692390181227152200\",\n          \"multiflag\": \"\",\n          \"updatetime\": \"1689897342\",\n          \"eventstatus\": \"open\",\n          \"filtercksum\": \"1306626736\",\n          \"lastlogtime\": \"1689897176\",\n          \"triggername\": \"Default-Recon-Activity-By-Endpoint\",\n          \"firstlogtime\": \"1689811436\",\n          \"handler_type\": \"basic\",\n          \"alert_part_info\": {\n            \"ruleid\": \"4\",\n            \"devtype\": 0,\n            \"logtype\": 10,\n            \"subtype\": -1,\n            \"hdlrhash\": 1147263883,\n            \"rulename\": \"HTTPS IP scanning detected\",\n            \"selector\": 1404381419878726000,\n            \"handlerid\": \"Default-Recon-Activity-By-Endpoint\",\n            \"handlername\": \"30015\"\n          },\n          \"automation_stitch\": \"no\"\n        },\n        {\n          \"tag\": \"Default,Risky,Recon,HTTPS\",\n          \"epid\": \"1032\",\n          \"epip\": \"10.2.0.8\",\n          \"euid\": \"1073\",\n          \"vdom\": \"root\",\n          \"devid\": \"FGVM02TM23008636\",\n          \"ackflag\": \"no\",\n          \"alertid\": \"202307201000000344\",\n          \"devname\": \"Branch_Office_02\",\n          \"devtype\": \"FortiGate\",\n          \"logtype\": \"traffic\",\n          \"subject\": \"IP scanning on Port: 443 detected\",\n          \"filterid\": \"4\",\n          \"groupby1\": \"endpoint:Kit Fox PC\",\n          \"groupby2\": \"dstport:443\",\n          \"logcount\": \"438\",\n          \"readflag\": \"no\",\n          \"severity\": \"medium\",\n          \"alerttime\": \"1689885294\",\n          \"eventtype\": \"traffic\",\n          \"extrainfo\": \"Recon activity from: 10.2.0.8:54848,.. to 23.32.61.55,..:443\",\n          \"filterkey\": \"-3692390181227152200\",\n          \"multiflag\": \"\",\n          \"updatetime\": \"1689897660\",\n          \"eventstatus\": \"open\",\n          \"filtercksum\": \"1306626736\",\n          \"lastlogtime\": \"1689897506\",\n          \"triggername\": \"Default-Recon-Activity-By-Endpoint\",\n          \"firstlogtime\": \"1689811771\",\n          \"handler_type\": \"basic\",\n          \"alert_part_info\": {\n            \"ruleid\": \"4\",\n            \"devtype\": 0,\n            \"logtype\": 10,\n            \"subtype\": -1,\n            \"hdlrhash\": 1147263883,\n            \"rulename\": \"HTTPS IP scanning detected\",\n            \"selector\": 1404381419878726000,\n            \"handlerid\": \"Default-Recon-Activity-By-Endpoint\",\n            \"handlername\": \"30015\"\n          },\n          \"automation_stitch\": \"no\"\n        }\n      ]\n    },\n    \"jsonrpc\": \"2.0\"\n  },\n  \"status\": \"Success\",\n  \"message\": \"\",\n  \"operation\": null,\n  \"execution_time\": \"3 seconds 157 ms\"\n}",
                "operationTitle": "Get Event",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "486b9931-9729-4ffc-856c-578f244f15e1"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    },
                    "useMockOutput": "{{globalVars.Demo_mode}}"
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "1cd36733-7b99-4418-9594-6821dedaf256"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Fetch Related Assets",
            "targetStep": "\/api\/3\/workflow_steps\/b66fa412-f186-4306-94f0-1dd54d3a3592",
            "sourceStep": "\/api\/3\/workflow_steps\/c86fed14-ffa8-4670-b45a-6e5e84a6246c",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "928f5bc4-57c2-4603-aa5d-8b1221b69a01"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Outbreak Alert Events -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/c86fed14-ffa8-4670-b45a-6e5e84a6246c",
            "sourceStep": "\/api\/3\/workflow_steps\/486b9931-9729-4ffc-856c-578f244f15e1",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8078e172-99f8-44d6-9294-e3ed791b4086"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get Outbreak Alert Events",
            "targetStep": "\/api\/3\/workflow_steps\/486b9931-9729-4ffc-856c-578f244f15e1",
            "sourceStep": "\/api\/3\/workflow_steps\/1cd36733-7b99-4418-9594-6821dedaf256",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "ceb05cba-49ec-42a7-8204-5ea63ee7d49e"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "87f3b5c5-f79e-492f-8540-f1f5ed5e1392",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Subroutine",
        "Outbreak Alert",
        "FortiAnalyzer"
    ]
}