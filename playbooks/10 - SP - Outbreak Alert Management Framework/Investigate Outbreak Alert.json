{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Investigate Outbreak Alert",
    "aliasName": null,
    "tag": null,
    "description": "Investigate Outbreak Alert on different SIEM tools, remediate and mitigate",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/2ae30943-7a2f-435b-a100-3ec7c3e2294b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/69054683-770e-4caa-8727-b38d9c7da7e9",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Azure Log Analytics Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"Azure Log Analytics\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.azureLogAnalytics_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "time_span": "{{vars.from_date}}",
                    "azureLogAnalytics_query": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/21d97105-d3fd-4ea2-9f34-c4c33e60aff4"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "e3623dee-b2f7-4179-a4fb-2145d7af13d0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Fortinet Fabric Hunting",
            "description": null,
            "arguments": {
                "tmp": "{% for item in vars.steps.Get_Hunting_Rules %}\n{% if item.fortiSIEM != None %}\n{% set _ = vars.fortisiem_query.append(item.fortiSIEM | from_json) %}\n{% endif %}\n{% if item.fortiAnalyzer != None %}\n{% set _ = vars.fortiAnalyzer_query.append(item.fortiAnalyzer | from_json) %}\n{% endif %}\n{% endfor %}",
                "fortisiem_event_count": "5",
                "fortisiem_incidentStatus": "Active",
                "fortisiem_incident_count": "1000"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "7f280a37-35dc-4ff6-bb91-807f9751b842"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get FortiAnalyzer Events",
            "description": null,
            "arguments": {
                "when": "{{\"Fortinet FortiAnalyzer\" in vars.threat_hunt}}",
                "arguments": {
                    "to_date": "{{vars.to_date}}",
                    "from_date": "{{vars.from_date}}",
                    "fortiAnalyzer_query": "{{vars.fortiAnalyzer_query}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/87f3b5c5-f79e-492f-8540-f1f5ed5e1392"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "b2fb4b0c-b6cd-43c6-8acd-940f6995d27d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get FortiSIEM Incident",
            "description": null,
            "arguments": {
                "when": "{{\"Fortinet FortiSIEM\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.fortisiem_query}}",
                    "__bulk": false,
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "to_date": "{{vars.to_date}}",
                    "from_date": "{{arrow.utcnow().shift(days=vars.from_date).format('YYYY-MM-DDTHH:mm:ss.ssss')}}Z",
                    "fortiSIEM_query": "{{vars.item.eventType}}",
                    "fortisiem_event_count": "{{vars.fortisiem_event_count}}",
                    "fortisiem_incidentStatus": "{{vars.fortisiem_incidentStatus}}",
                    "fortisiem_incident_count": "{{vars.fortisiem_incident_count}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/cc178f00-d898-4514-94e5-3388d5e3ac8e"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "28d36fdd-05ac-46f9-949f-deceaf35ccef"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Hunting Rules",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                },
                "module": "threat_hunt_rules?$limit=30&$relationships=true&$fsr_max_relation_count=100",
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Initiating <strong><em>Outbreak Alert: {{vars.input.records[0].title}}<\/em><\/strong> Investigation<\/p>",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "6b11a28e-3ed5-4725-9228-728236b0ffbc"
        },
        {
            "@type": "WorkflowStep",
            "name": "Mitigation",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "Mitigation Measures",
                        "description": "Following are the recommended mitigation measures are required for **{{vars.input.records[0].title}} **\n\n{{vars.input.records[0].mitigation}}",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Following are the recommended mitigation measures are required for **{{vars.input.records[0].title}} **<\/p>\n<p>&nbsp;<\/p>\n<p>{{vars.input.records[0].mitigation}}<\/p>",
                    "records": "{{vars.input.records[0]['@id']}}",
                    "parentstepid": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc"
                },
                "agent_id": null,
                "resources": "outbreak_alerts",
                "owner_detail": {
                    "isAssigned": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "OK",
                            "primary": true
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "1515",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "146df7db-572d-4515-a2d1-615fcb90522f"
        },
        {
            "@type": "WorkflowStep",
            "name": "QRadar Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"IBM QRadar\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.q_radar_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "q_radar_query": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/bd0c5112-9cfd-428c-b39e-919c859d3032"
            },
            "status": null,
            "top": "1110",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "c39ef6a4-103f-4229-ab70-f79b83a93e73"
        },
        {
            "@type": "WorkflowStep",
            "name": "Remediation",
            "description": null,
            "arguments": {
                "arguments": {
                    "from_date": "{{arrow.utcnow().shift(days=vars.from_date).format('YYYY-MM-DDTHH:mm:ss.ssss')}}Z"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/4d3d05aa-a2c7-460f-80bb-214726e0884f"
            },
            "status": null,
            "top": "1380",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e"
        },
        {
            "@type": "WorkflowStep",
            "name": "SIEM Advanced Hunting",
            "description": null,
            "arguments": {
                "tmp": "{% for item in vars.steps.Get_Hunting_Rules %}\n{% if item.qRadar != None %}\n{% set _ = vars.q_radar_query.append({\"title\": item.title, \"query\": item.qRadar}) %}\n{% endif %}\n{% if item.splunk != None %}\n{% set _ = vars.splunk_query.append({\"title\": item.title, \"query\": item.splunk}) %}\n{% endif %}\n{% if item.arcSight != None %}\n{% set _ = vars.arc_sight_query.append({\"title\": item.title, \"query\": item.arcSight}) %}\n{% endif %}\n{% if item.azureLogAnalytics != None %}\n{% set _ = vars.azureLogAnalytics_query.append({\"title\": item.title, \"query\": item.azureLogAnalytics}) %}\n{% endif %}\n{% if item.elasticSearch != None %}\n{% set _ = vars.elastic_search.append({\"title\": item.title, \"query\": item.elasticSearch}) %}\n{% endif %}\n{% endfor %}",
                "record_count": "1000"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "8ac51aed-78e1-4048-97e7-ef49eadc7974"
        },
        {
            "@type": "WorkflowStep",
            "name": "Splunk Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"Splunk\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.splunk_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "max_count": "{{vars.record_count}}",
                    "latest_time": "now",
                    "splunk_query": "{{vars.item}}",
                    "earliest_time:": "{{vars.from_date}}h@h"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/0285b815-4454-49af-ac72-a737d16fa11c"
            },
            "status": null,
            "top": "1245",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "2798ccb0-94da-47c9-ba43-54a42bca7a78"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "b5814fbf-0355-4ed4-8b95-a9ed38bc1b25",
                "resources": [
                    "outbreak_alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "outbreak_alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "69054683-770e-4caa-8727-b38d9c7da7e9"
        },
        {
            "@type": "WorkflowStep",
            "name": "Threat Hunting",
            "description": null,
            "arguments": {
                "to_date": "{{arrow.utcnow().format(\"YYYY-MM-DDTHH:mm:ss.SS\")}}Z",
                "from_date": "-15",
                "threat_hunt": "{{globalVars.threat_hunt_integrations}}",
                "splunk_query": "[]",
                "q_radar_query": "[]",
                "elastic_search": "[]",
                "arc_sight_query": "[]",
                "fortisiem_query": "[]",
                "outbreak_alert_iri": "{{vars.input.records[0]['@id']}}",
                "fortiAnalyzer_query": "[]",
                "azureLogAnalytics_query": "[]"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "acc4a508-9574-46d2-b13d-d902f7a2deab"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Azure Log Analytics Hunting -> QRadar Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/c39ef6a4-103f-4229-ab70-f79b83a93e73",
            "sourceStep": "\/api\/3\/workflow_steps\/e3623dee-b2f7-4179-a4fb-2145d7af13d0",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "95090bd5-6a46-45c9-a0e1-fd8c27d3e5d1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Fortinet Fabric Hunting -> Get FortiAnalyzer Events",
            "targetStep": "\/api\/3\/workflow_steps\/b2fb4b0c-b6cd-43c6-8acd-940f6995d27d",
            "sourceStep": "\/api\/3\/workflow_steps\/7f280a37-35dc-4ff6-bb91-807f9751b842",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e5759d8f-0889-402b-84f8-d2865de0dd82"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get FortiAnalyzer Events -> Get FortiSIEM Incident",
            "targetStep": "\/api\/3\/workflow_steps\/28d36fdd-05ac-46f9-949f-deceaf35ccef",
            "sourceStep": "\/api\/3\/workflow_steps\/b2fb4b0c-b6cd-43c6-8acd-940f6995d27d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "ec7227af-1687-497f-a36b-a742e6c84a4e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get FortiSIEM Incident -> SIEM Advanced Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/8ac51aed-78e1-4048-97e7-ef49eadc7974",
            "sourceStep": "\/api\/3\/workflow_steps\/28d36fdd-05ac-46f9-949f-deceaf35ccef",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8be7fd10-9908-4fcd-ad51-270b032a97a5"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Hunting Rules -> Threat Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/acc4a508-9574-46d2-b13d-d902f7a2deab",
            "sourceStep": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "21ade366-34a4-452d-9f14-8704e63e305a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "QRadar Hunting -> Splunk Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/2798ccb0-94da-47c9-ba43-54a42bca7a78",
            "sourceStep": "\/api\/3\/workflow_steps\/c39ef6a4-103f-4229-ab70-f79b83a93e73",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "70a10d98-5c01-4dcc-8895-2fb04c26ee5a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Remediation -> Mitigation",
            "targetStep": "\/api\/3\/workflow_steps\/146df7db-572d-4515-a2d1-615fcb90522f",
            "sourceStep": "\/api\/3\/workflow_steps\/9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e9d25633-0db6-4136-b3d1-29bfbca0e0d7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "SIEM Advanced Hunting -> Azure Log Analytics Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/e3623dee-b2f7-4179-a4fb-2145d7af13d0",
            "sourceStep": "\/api\/3\/workflow_steps\/8ac51aed-78e1-4048-97e7-ef49eadc7974",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "4d924c13-6f6c-4fff-9cc7-d4020d59437a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Splunk Hunting -> Remediation",
            "targetStep": "\/api\/3\/workflow_steps\/9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e",
            "sourceStep": "\/api\/3\/workflow_steps\/2798ccb0-94da-47c9-ba43-54a42bca7a78",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "6c36ba46-ea3d-4390-a3c3-af27efbda340"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Find Hunting Rules",
            "targetStep": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc",
            "sourceStep": "\/api\/3\/workflow_steps\/69054683-770e-4caa-8727-b38d9c7da7e9",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5cc216fd-20be-4a6c-970e-68da0d914730"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Threat Hunting -> Fortinet Fabric Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/7f280a37-35dc-4ff6-bb91-807f9751b842",
            "sourceStep": "\/api\/3\/workflow_steps\/acc4a508-9574-46d2-b13d-d902f7a2deab",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "57ff2249-07b9-46f1-be9f-0c67dbdcc3f8"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "93d93b2d-1598-4bb7-9fa6-85c2f8b9d876",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ManualTrigger",
        "Outbreak Alert"
    ]
}