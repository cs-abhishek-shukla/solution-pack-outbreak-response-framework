{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Investigate Outbreak Alert",
    "aliasName": null,
    "tag": null,
    "description": "Investigate Outbreak Alert on different SIEM tools, remediate and mitigate",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/2ae30943-7a2f-435b-a100-3ec7c3e2294b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/69054683-770e-4caa-8727-b38d9c7da7e9",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Azure Log Analytics Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"Azure Log Analytics\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.azureLogAnalytics_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "time_span": "{{vars.from_date}}",
                    "azureLogAnalytics_query": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/21d97105-d3fd-4ea2-9f34-c4c33e60aff4"
            },
            "status": null,
            "top": "1110",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "e3623dee-b2f7-4179-a4fb-2145d7af13d0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "to_date": "{{arrow.utcnow().format(\"YYYY-MM-DDTHH:mm:ss.SS\")}}Z",
                "from_date": "-15",
                "threat_hunt": "{{globalVars.threat_hunt_integrations}}",
                "splunk_query": "[]",
                "q_radar_query": "[]",
                "elastic_search": "[]",
                "arc_sight_query": "[]",
                "fortisiem_query": "[]",
                "outbreak_alert_iri": "{{vars.input.records[0]['@id']}}",
                "fortiAnalyzer_query": "[]",
                "fortisiem_event_count": "5",
                "azureLogAnalytics_query": "[]",
                "fortisiem_incidentStatus": "Active",
                "fortisiem_incident_count": "1000"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "acc4a508-9574-46d2-b13d-d902f7a2deab"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create IOCs as Threat Intel Feeds",
            "description": null,
            "arguments": {
                "arguments": [],
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/71c09b38-df72-4ed8-8e84-4c3a2ae1d261"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "6487a8b6-5a7f-4b67-a2cf-4360e2b31ef6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Find KEVs CVEs",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].cVEList | length > 0}}",
                "arguments": [],
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/e9cad34b-4393-4d31-a8f2-82a5a8cb0ade"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "861a11ec-6b1a-4999-9f13-2de5244f37b6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get FortiAnalyzer Events",
            "description": null,
            "arguments": {
                "when": "{{\"Fortinet FortiAnalyzer\" in vars.threat_hunt}}",
                "arguments": {
                    "to_date": "{{vars.to_date}}",
                    "from_date": "{{vars.from_date}}",
                    "fortiAnalyzer_query": "{{vars.fortiAnalyzer_query}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/87f3b5c5-f79e-492f-8540-f1f5ed5e1392"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "b2fb4b0c-b6cd-43c6-8acd-940f6995d27d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get FortiSIEM Incident",
            "description": null,
            "arguments": {
                "when": "{{\"Fortinet FortiSIEM\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.fortisiem_query}}",
                    "__bulk": false,
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "to_date": "{{vars.to_date}}",
                    "from_date": "{{arrow.utcnow().shift(days=vars.from_date).format('YYYY-MM-DDTHH:mm:ss.ssss')}}Z",
                    "fortiSIEM_query": "{{vars.item.eventType}}",
                    "fortisiem_event_count": "{{vars.fortisiem_event_count}}",
                    "fortisiem_incidentStatus": "{{vars.fortisiem_incidentStatus}}",
                    "fortisiem_incident_count": "{{vars.fortisiem_incident_count}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/cc178f00-d898-4514-94e5-3388d5e3ac8e"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "28d36fdd-05ac-46f9-949f-deceaf35ccef"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Hunting Rules",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                },
                "module": "threat_hunt_rules?$limit=30&$relationships=true&$fsr_max_relation_count=100",
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Initiating <strong><em>Outbreak Alert: {{vars.input.records[0].title}}<\/em><\/strong> Investigation<\/p>",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "6b11a28e-3ed5-4725-9228-728236b0ffbc"
        },
        {
            "@type": "WorkflowStep",
            "name": "Mitigation",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "Mitigation Measures",
                        "description": "Following are the recommended mitigation measures are required for **{{vars.input.records[0].title}}**\n\n{{vars.input.records[0].mitigation}}",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Following are the recommended mitigation measures are required for <strong>{{vars.input.records[0].title}}<\/strong><\/p>\n<p>&nbsp;<\/p>\n<p>{{vars.input.records[0].mitigation}}<\/p>",
                    "records": "{{vars.input.records[0]['@id']}}",
                    "parentstepid": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc"
                },
                "agent_id": null,
                "resources": "outbreak_alerts",
                "owner_detail": {
                    "isAssigned": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "OK",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/356b5cd0-70cd-4e31-a950-62d4485d9f41"
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "1650",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "146df7db-572d-4515-a2d1-615fcb90522f"
        },
        {
            "@type": "WorkflowStep",
            "name": "QRadar Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"IBM QRadar\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.q_radar_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "q_radar_query": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/bd0c5112-9cfd-428c-b39e-919c859d3032"
            },
            "status": null,
            "top": "1245",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "c39ef6a4-103f-4229-ab70-f79b83a93e73"
        },
        {
            "@type": "WorkflowStep",
            "name": "Remediation",
            "description": null,
            "arguments": {
                "arguments": [],
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/4d3d05aa-a2c7-460f-80bb-214726e0884f"
            },
            "status": null,
            "top": "1515",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set Hunting Rules",
            "description": null,
            "arguments": {
                "_tmp": "{% for item in vars.steps.Get_Hunting_Rules %}\n{% if item.fortiSIEM != None %}\n{% set _ = vars.fortisiem_query.append(item.fortiSIEM | from_json) %}\n{% endif %}\n{% if item.fortiAnalyzer != None %}\n{% set _ = vars.fortiAnalyzer_query.append(item.fortiAnalyzer | from_json) %}\n{% endif %}\n{% if item.qRadar != None %}\n{% set _ = vars.q_radar_query.append({\"title\": item.title, \"query\": item.qRadar}) %}\n{% endif %}\n{% if item.splunk != None %}\n{% set _ = vars.splunk_query.append({\"title\": item.title, \"query\": item.splunk}) %}\n{% endif %}\n{% if item.arcSight != None %}\n{% set _ = vars.arc_sight_query.append({\"title\": item.title, \"query\": item.arcSight}) %}\n{% endif %}\n{% if item.azureLogAnalytics != None %}\n{% set _ = vars.azureLogAnalytics_query.append({\"title\": item.title, \"query\": item.azureLogAnalytics}) %}\n{% endif %}\n{% endfor %}"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "7f280a37-35dc-4ff6-bb91-807f9751b842"
        },
        {
            "@type": "WorkflowStep",
            "name": "Splunk Hunting",
            "description": null,
            "arguments": {
                "when": "{{\"Splunk\" in vars.threat_hunt}}",
                "for_each": {
                    "item": "{{vars.splunk_query}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "max_count": "{{vars.record_count}}",
                    "latest_time": "now",
                    "splunk_query": "{{vars.item}}",
                    "earliest_time:": "{{vars.from_date}}h@h"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/0285b815-4454-49af-ac72-a737d16fa11c"
            },
            "status": null,
            "top": "1380",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "2798ccb0-94da-47c9-ba43-54a42bca7a78"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "b5814fbf-0355-4ed4-8b95-a9ed38bc1b25",
                "resources": [
                    "outbreak_alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "outbreak_alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "69054683-770e-4caa-8727-b38d9c7da7e9"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Remediation Task",
            "description": null,
            "arguments": {
                "resource": {
                    "description": "{{vars.steps.Remediation.description}}\nFollowing are the recommended mitigation measures are required for **{{vars.input.records[0].title}}**\n\n{{vars.input.records[0].mitigation}}"
                },
                "operation": "Append",
                "collection": "{{vars.steps.Remediation['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/tasks",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "1785",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "356b5cd0-70cd-4e31-a950-62d4485d9f41"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Azure Log Analytics Hunting -> QRadar Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/c39ef6a4-103f-4229-ab70-f79b83a93e73",
            "sourceStep": "\/api\/3\/workflow_steps\/e3623dee-b2f7-4179-a4fb-2145d7af13d0",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "95090bd5-6a46-45c9-a0e1-fd8c27d3e5d1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Find KEVs CVEs",
            "targetStep": "\/api\/3\/workflow_steps\/861a11ec-6b1a-4999-9f13-2de5244f37b6",
            "sourceStep": "\/api\/3\/workflow_steps\/acc4a508-9574-46d2-b13d-d902f7a2deab",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "1a01c551-d30c-47bc-8503-2b4e2961c467"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create IOCs as Threat Intel Feeds -> Get Hunting Rules",
            "targetStep": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc",
            "sourceStep": "\/api\/3\/workflow_steps\/6487a8b6-5a7f-4b67-a2cf-4360e2b31ef6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "46195525-63e1-4d11-a408-2c266f14c200"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Find KEVs CVEs -> Create IOCs as Threat Intel Feeds",
            "targetStep": "\/api\/3\/workflow_steps\/6487a8b6-5a7f-4b67-a2cf-4360e2b31ef6",
            "sourceStep": "\/api\/3\/workflow_steps\/861a11ec-6b1a-4999-9f13-2de5244f37b6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "28465e99-0903-43ce-9b07-9a9a68d4c360"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get FortiAnalyzer Events -> Get FortiSIEM Incident",
            "targetStep": "\/api\/3\/workflow_steps\/28d36fdd-05ac-46f9-949f-deceaf35ccef",
            "sourceStep": "\/api\/3\/workflow_steps\/b2fb4b0c-b6cd-43c6-8acd-940f6995d27d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "ec7227af-1687-497f-a36b-a742e6c84a4e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get FortiSIEM Incident -> Azure Log Analytics Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/e3623dee-b2f7-4179-a4fb-2145d7af13d0",
            "sourceStep": "\/api\/3\/workflow_steps\/28d36fdd-05ac-46f9-949f-deceaf35ccef",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a2c7feb3-9e47-44af-85eb-992eb5150f22"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Hunting Rules -> Fortinet Fabric Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/7f280a37-35dc-4ff6-bb91-807f9751b842",
            "sourceStep": "\/api\/3\/workflow_steps\/6b11a28e-3ed5-4725-9228-728236b0ffbc",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "24a34d46-3c8c-4dc6-95f5-292adedd9803"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Mitigation -> Update Remediation Task",
            "targetStep": "\/api\/3\/workflow_steps\/356b5cd0-70cd-4e31-a950-62d4485d9f41",
            "sourceStep": "\/api\/3\/workflow_steps\/146df7db-572d-4515-a2d1-615fcb90522f",
            "label": "OK",
            "isExecuted": false,
            "group": null,
            "uuid": "95c504df-6089-4492-8a74-4e08b84478c6"
        },
        {
            "@type": "WorkflowRoute",
            "name": "QRadar Hunting -> Splunk Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/2798ccb0-94da-47c9-ba43-54a42bca7a78",
            "sourceStep": "\/api\/3\/workflow_steps\/c39ef6a4-103f-4229-ab70-f79b83a93e73",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "70a10d98-5c01-4dcc-8895-2fb04c26ee5a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Remediation -> Mitigation",
            "targetStep": "\/api\/3\/workflow_steps\/146df7db-572d-4515-a2d1-615fcb90522f",
            "sourceStep": "\/api\/3\/workflow_steps\/9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e9d25633-0db6-4136-b3d1-29bfbca0e0d7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set Hunting Rules -> Get FortiAnalyzer Events",
            "targetStep": "\/api\/3\/workflow_steps\/b2fb4b0c-b6cd-43c6-8acd-940f6995d27d",
            "sourceStep": "\/api\/3\/workflow_steps\/7f280a37-35dc-4ff6-bb91-807f9751b842",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "fb8c3e93-41e2-479f-b7eb-81907233ceb6"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Splunk Hunting -> Remediation",
            "targetStep": "\/api\/3\/workflow_steps\/9c8029b7-fbb1-4f2f-ab2d-cfc3242be37e",
            "sourceStep": "\/api\/3\/workflow_steps\/2798ccb0-94da-47c9-ba43-54a42bca7a78",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "6c36ba46-ea3d-4390-a3c3-af27efbda340"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Threat Hunting",
            "targetStep": "\/api\/3\/workflow_steps\/acc4a508-9574-46d2-b13d-d902f7a2deab",
            "sourceStep": "\/api\/3\/workflow_steps\/69054683-770e-4caa-8727-b38d9c7da7e9",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "03841d30-3811-4bbd-8ba6-7fcb5689b7dd"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "93d93b2d-1598-4bb7-9fa6-85c2f8b9d876",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ManualTrigger",
        "Outbreak Alert"
    ]
}