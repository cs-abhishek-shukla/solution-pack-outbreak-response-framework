{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Create IOCs as Threat Intel Feeds",
    "aliasName": null,
    "tag": null,
    "description": "Create the Threat Feeds in Threat Intel Module for the specified outbreak alert IOC's",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/2ae30943-7a2f-435b-a100-3ec7c3e2294b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/308b02e7-09d2-4d28-b8e2-0ab38e0b935c",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Compute CSV Filepath",
            "description": null,
            "arguments": {
                "params": {
                    "iri": "{{vars.ioc_csv_file['@id']}}"
                },
                "version": "3.2.3",
                "connector": "cyops_utilities",
                "operation": "download_file_from_cyops",
                "operationTitle": "File: Compute Hash",
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "ab8ecaeb-65bc-48ed-85b4-8944da4f3644"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "tlp_map": "{'Red': {{'TrafficLightProtocol' | picklist('Red', 'uuid')}}','Amber':{{'TrafficLightProtocol' | picklist('Amber', 'uuid')}}','Green':{{'TrafficLightProtocol' | picklist('Green','uuid')}},'White': {{'TrafficLightProtocol' | picklist('White', 'uuid')}}}",
                "ioc_csv_file": "{{vars.input.records[0].iOCCSVFile}}",
                "confidence_map": "{\"High\": 100, \"Medium\": 90, \"Low\": 80}",
                "reputation_map": "{'Good': \"{{'IndicatorReputation' | picklist('Good', 'uuid')}}\",'Suspicious': \"{{'IndicatorReputation' | picklist('Suspicious', 'uuid')}}\",'Malicious': \"{{'IndicatorReputation' | picklist('Malicious', 'uuid')}}\",'No Reputation Available': \"{{'IndicatorReputation' | picklist('No Reputation Available', 'uuid')}}\",'TBD': \"{{'IndicatorReputation' | picklist('TBD', 'uuid')}}\"}",
                "typeOfFeed_map": "{'Domain': \"{{'ThreatIntelFeedType' | picklist('Domain', 'uuid')}}\",'URL': \"{{'ThreatIntelFeedType' | picklist('URL', 'uuid')}}\", 'ip_port': \"{{'ThreatIntelFeedType' | picklist('Network Activity', 'uuid')}}\",'IP': \"{{'ThreatIntelFeedType' | picklist('IP Address', 'uuid')}}\", 'file_hash_sha256': \"{{'ThreatIntelFeedType' | picklist('FileHash-SHA256', 'uuid')}}\", 'file_hash_sha1': \"{{'ThreatIntelFeedType' | picklist('FileHash-SHA1', 'uuid')}}\", 'file_hash_md5': \"{{'ThreatIntelFeedType' | picklist('FileHash-MD5', 'uuid')}}\", 'File': \"{{'ThreatIntelFeedType' | picklist('FileHash', 'uuid')}}\", 'Email': \"{{'ThreatIntelFeedType' | picklist('Email Address', 'uuid')}}\"}",
                "threatTypes_map": "{\"anonymization\": \"{{'Threat Type' | picklist('Anonymization', 'uuid')}}\", 'bot': \"{{'Threat Type' | picklist('Bot', 'uuid')}}\", 'cc_skimming': \"{{'Threat Type' | picklist('Credit Card Skimming', 'uuid')}}\", 'cryptocurrency_mining': \"{{'Threat Type' | picklist('Cryptocurrency Mining', 'uuid')}}\", 'malware': \"{{'Threat Type' | picklist('Malware', 'uuid')}}\", 'malware_cnc': \"{{'Threat Type' | picklist('Malware C2', 'uuid')}}\", 'phishing': \"{{'Threat Type' | picklist('Phishing', 'uuid')}}\",'pup': \"{{'Threat Type' | picklist('Potential Unwanted Program (PUP)', 'uuid')}}\", 'pup_cnc': \"{{'Threat Type' | picklist('PUP Spyware C2', 'uuid')}}\", 'scanner': \"{{'Threat Type' | picklist('Scanner', 'uuid')}}\", 'spam_sender': \"{{'Threat Type' | picklist('Spam Sender', 'uuid')}}\", 'spam_url': \"{{'Threat Type' | picklist('Spam URL', 'uuid')}}\", 'potential_malware': \"{{'Threat Type' | picklist('Potential Malware', 'uuid')}}\", 'potential_phishing': \"{{'Threat Type' | picklist('Potential Phishing', 'uuid')}}\", 'potential_spam': \"{{'Threat Type' | picklist('Potential Spam', 'uuid')}}\"}",
                "killChainPhases_map": "{\"reconnaissance\": \"{{'KillChainPhases' | picklist('Reconnaissance', 'uuid')}}\", \"weaponization\": \"{{'KillChainPhases' | picklist('Weaponization', 'uuid')}}\", \"Delivery\": \"{{'KillChainPhases' | picklist('Delivery', 'uuid')}}\", \"Exploitation\": \"{{'KillChainPhases' | picklist('Exploitation', 'uuid')}}\", \"Installation\": \"{{'KillChainPhases' | picklist('Installation', 'uuid')}}\", \"Command & Control\": \"{{'KillChainPhases' | picklist('Command & Control', 'uuid')}}\", \"actions-on-objectives\": \"{{'KillChainPhases' | picklist('Actions on Objectives', 'uuid')}}\"}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "c9d30f3d-d97d-485b-bc81-f198e800fdb7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Convert CSV to Dictionary",
            "description": null,
            "arguments": {
                "params": {
                    "type": "filepath",
                    "file_name": "{{vars.steps.Compute_CSV_Filepath.data['cyops_file_path']}}",
                    "file_type": "CSV"
                },
                "version": "3.2.3",
                "connector": "cyops_utilities",
                "operation": "convert_to_json",
                "operationTitle": "Utils: Convert XML, CSV, XLS or XLSX Files to Dictionary",
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "690c0252-4b20-4d6c-a37b-d5ac7bbff57d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create IOC Feeds",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Convert_CSV_to_Dictionary.data}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "tLP": "\/api\/3\/picklists\/7bff95b7-6438-4b01-b23a-0fe8cb5b33d3",
                    "value": "{{ vars.item.Indicator }}",
                    "source": "Outbreak Alert",
                    "sourceId": "Outbreak Alert",
                    "__replace": "true",
                    "confidence": "{{ (vars.item.Confidence) | resolveRange(vars.confidence_map) }}",
                    "recordTags": "{% if vars.item.Tags %}{{(vars.item.Tags.split(\"|\")) | join(\",\") }},{{\"Outbreak Alert\"}}{% endif %}",
                    "reputation": "\/api\/3\/picklists\/7074e547-7785-4979-be32-c6d0c863e4bd",
                    "sourceData": "{{ vars.item | toJSON}}",
                    "typeOfFeed": "{{ (vars.item.Type) | resolveRange(vars.typeOfFeed_map) }}",
                    "outbreakAlerts": "{{vars.input.records[0]['@id']}}",
                    "killChainPhases": "{% if '|' in vars.item['Kill Chain'] %}{% set k = (vars.item['Kill Chain'].split('|')[0]).strip() %}['{{ (k)| resolveRange(vars.killChainPhases_map) }}']{% elif vars.item['Kill Chain'] %}['{{ (vars.item['Kill Chain'])| resolveRange(vars.killChainPhases_map) }}']{% else %}None{% endif %}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/threat_intel_feeds",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite",
                    "threatTypes": "Overwrite",
                    "killChainPhases": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "51dcffdd-76cc-4bc0-b9d1-aaa0408e9c40"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "resource": "outbreak_alerts",
                "resources": [
                    "outbreak_alerts"
                ],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": [
                            "{{vars.input.records[0]}}"
                        ]
                    }
                },
                "fieldbasedtrigger": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/ea155646-3821-4542-9702-b246da430a8d",
            "group": null,
            "uuid": "308b02e7-09d2-4d28-b8e2-0ab38e0b935c"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Compute CSV Filepath -> Convert CSV to Dictionary",
            "targetStep": "\/api\/3\/workflow_steps\/690c0252-4b20-4d6c-a37b-d5ac7bbff57d",
            "sourceStep": "\/api\/3\/workflow_steps\/ab8ecaeb-65bc-48ed-85b4-8944da4f3644",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "2ebf1214-4aef-43b0-a3ce-76f69b2e48c0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Convert CSV to Dictionary -> Create IOC Feeds",
            "targetStep": "\/api\/3\/workflow_steps\/51dcffdd-76cc-4bc0-b9d1-aaa0408e9c40",
            "sourceStep": "\/api\/3\/workflow_steps\/690c0252-4b20-4d6c-a37b-d5ac7bbff57d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "1c3f5c66-a0db-45f9-ad91-730908b632f4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Copy of Configuration -> Compute CSV Filepath",
            "targetStep": "\/api\/3\/workflow_steps\/ab8ecaeb-65bc-48ed-85b4-8944da4f3644",
            "sourceStep": "\/api\/3\/workflow_steps\/c9d30f3d-d97d-485b-bc81-f198e800fdb7",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "63b58267-12f0-4900-9eba-df480652434b"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Copy of Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/c9d30f3d-d97d-485b-bc81-f198e800fdb7",
            "sourceStep": "\/api\/3\/workflow_steps\/308b02e7-09d2-4d28-b8e2-0ab38e0b935c",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5d8d67e1-f584-4934-a5ff-8a477fc2444c"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "71c09b38-df72-4ed8-8e84-4c3a2ae1d261",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "PostCreate",
        "Outbreak Alert",
        "ThreatFeed"
    ]
}